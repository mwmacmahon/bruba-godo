# bruba-godo configuration
# Copy this file to config.yaml and customize for your setup
version: 3

# Bot transport: how to run commands as the bot user
# Options: sudo (same machine), tailscale-ssh, ssh (default)
transport: ssh

ssh:
  host: <your-ssh-host>            # SSH host alias from ~/.ssh/config

remote:
  home: /Users/<bot-username>      # Or /home/<bot-username> on Linux
  workspace: /Users/<bot-username>/agents/<agent-id>
  openclaw: /Users/<bot-username>/.openclaw
  agent_id: <your-agent-id>        # e.g., mybot-main

local:
  mirror: mirror
  sessions: sessions
  logs: logs
  intake: intake
  reference: reference
  exports: exports
  assembled: assembled

# Copy repo code (scripts, docs, prompts) to bot workspace during push
# Read-only reference - bot can read to understand codebase, not execute
clone_repo_code: false

# OpenClaw global defaults (synced to openclaw.json via sync-openclaw-config.sh)
# These settings apply to all agents unless overridden per-agent
openclaw:
  # Model defaults: primary model and fallbacks for all agents
  model:
    primary: opus                              # Main model (alias or full ID)
    fallbacks:
      - anthropic/claude-sonnet-4-5            # First fallback
      - anthropic/claude-haiku-4-5             # Second fallback

  # Compaction: how to handle context window limits
  compaction:
    mode: safeguard                            # safeguard, aggressive, or off
    reserve_tokens_floor: 20000                # Minimum tokens to keep after compaction
    memory_flush:
      enabled: true
      soft_threshold_tokens: 40000             # Trigger memory flush at this threshold
      prompt: |                                # Prompt sent to agent before compaction
        Write to memory/CONTINUATION.md immediately:
        1. Session summary
        2. In-progress work with status
        3. Open questions
        4. Next steps
        5. Relevant files

        Reply NO_REPLY when done.
      system_prompt: "CRITICAL: Session nearing compaction. Save all important context NOW."

  # Context pruning: how to prune old context
  context_pruning:
    mode: cache-ttl                            # cache-ttl, aggressive, or off
    ttl: 1h                                    # Time-to-live for cached context

  # Sandbox: Docker isolation settings
  sandbox:
    mode: "off"                                # all, off, or specific agents

  # Maximum concurrent agent sessions (global limit)
  max_concurrent: 4

  # Voice settings (synced to tools.media.audio + messages.tts)
  # API keys stay in openclaw.json env.vars (not synced from config.yaml)
  voice:
    # STT: Speech-to-text configuration
    stt:
      enabled: true                              # Enable automatic transcription
      max_bytes: 20971520                        # Max audio file size (20MB)
      timeout_seconds: 120                       # Transcription timeout
      language: en                               # Language hint for accuracy
      models:
        - provider: groq                         # STT provider (groq recommended)
          model: whisper-large-v3-turbo          # Whisper model variant

    # TTS: Text-to-speech configuration
    tts:
      auto: inbound                              # When to auto-TTS: inbound, always, off
      provider: elevenlabs                       # TTS provider
      max_text_length: 4000                      # Truncate responses longer than this
      timeout_ms: 30000                          # TTS generation timeout
      elevenlabs:
        voice_id: "<your-voice-id>"              # From ElevenLabs dashboard
        model_id: "eleven_multilingual_v2"       # ElevenLabs model
        voice_settings:
          stability: 0.5                         # 0-1: lower = more expressive
          similarity_boost: 0.75                 # 0-1: how closely to match original
          speed: 1.0                             # 0.5-2.0: playback speed

# Multi-agent configuration
# Each agent has its own workspace and prompt assembly config
agents:
  <agent-id>-main:
    workspace: /Users/<bot-username>/agents/<agent-id>-main
    prompts: [agents, tools]  # Which prompt files to assemble
    # Model: string alias or object with primary/fallbacks
    model: sonnet                              # Override global default
    # Heartbeat: false to disable, or object for proactive mode
    heartbeat: false                           # Main is reactive, no heartbeat
    # Tool permissions (synced to openclaw.json via sync-openclaw-config.sh)
    # Main agent: full capabilities except web (delegated to -web agent)
    tools_allow:
      - read
      - write
      - edit
      - exec
      - group:memory
      - group:sessions
      - image
      - message           # For media attachments (voice, images)
    # Web tools denied - use <agent-id>-web via sessions_send
    # sessions_spawn denied - no helper spawning (use peer agents)
    tools_deny:
      - browser
      - canvas
      - cron
      - gateway
      - web_search        # Use -web agent via sessions_send
      - web_fetch         # Use -web agent via sessions_send
      - sessions_spawn    # No helper spawning
    # OpenClaw built-in tool groups:
    #   group:sessions   - sessions_list, sessions_history, sessions_send, sessions_spawn, session_status
    #   group:memory     - memory_search, memory_get
    #   group:web        - web_search, web_fetch
    #   group:fs         - read, write, edit, apply_patch
    #   group:runtime    - exec, bash, process
    #   group:ui         - browser, canvas
    #   group:automation - cron, gateway
    # Note: Built-in groups work automatically.
    # IMPORTANT: After changing tool configs, restart the gateway: openclaw gateway restart
    # Prompt assembly sections
    # - base → include full template (templates/prompts/{NAME}.md)
    # - name → component (components/{name}/prompts/{NAME}.snippet.md)
    # - name → template section (templates/prompts/sections/{name}.md)
    # - bot:name → bot-managed section (preserved from mirror)
    agents_sections:
      - header
      - http-api
      - first-run
      - session
      - continuity
      - memory
      - distill
      - safety
      - bot:exec-approvals
      - cc-packets
      - external-internal
      - workspace
      - repo-reference
      - group-chats
      - tools
      # - web-search           # Enable for web search capability
      # - reminders            # Enable for reminders integration
      - voice
      # - heartbeats           # Enable for heartbeat mode
      - signal
      # - guru-routing         # Enable for technical deep-dive routing to -guru agent
      # - make-it-yours
    tools_sections:
      - base
      # - reminders            # Enable for reminders tool additions
    # Export config for this agent's memory content
    remote_path: memory
    include:
      scope: [meta, reference, transcripts]
      type: [prompt, doc, refdoc, claude_code_log]
    exclude:
      sensitivity: [sensitive, restricted]
    redaction: [names, health]

  <agent-id>-manager:
    workspace: /Users/<bot-username>/agents/<agent-id>-manager
    prompts: [agents, tools, heartbeat]
    # Model: sonnet for normal ops, haiku for heartbeats
    model:
      primary: anthropic/claude-sonnet-4-5
      fallbacks:
        - anthropic/claude-haiku-4-5
    # Heartbeat: proactive monitoring configuration
    heartbeat:
      every: 15m                               # Check every 15 minutes
      model: anthropic/claude-haiku-4-5        # Cheap model for heartbeats
      target: signal                           # Where to deliver alerts
      active_hours:
        start: "07:00"                         # Start at 7am
        end: "22:00"                           # End at 10pm
    # Tool permissions (synced to openclaw.json)
    # Manager: coordinator agent, needs exec for CLI tools (remindctl, icalBuddy)
    # Note: exec NOT denied - manager needs it for heartbeat checks
    tools_deny:
      - web_search        # Use -web agent via sessions_send
      - web_fetch         # Use -web agent via sessions_send
      - edit              # Read-only for manager
      - apply_patch       # Read-only for manager
      - browser
      - canvas
      - cron
      - gateway
      - sessions_spawn    # No helper spawning
    # Manager uses manager-base templates
    agents_sections:
      - manager-base
    tools_sections:
      - manager-base
    heartbeat_sections:
      - manager-base

  <agent-id>-helper:
    workspace: null
    prompts: []
    # Helpers have no persistent prompts - instructions come via spawn task
    # Helper tools defined in subagents section below

  <agent-id>-web:
    workspace: /Users/<bot-username>/agents/<agent-id>-web
    prompts: [agents]  # Uses agents assembly path with web-base template
    # Model: sonnet (stateless, no fallback needed)
    model: anthropic/claude-sonnet-4-5
    # Heartbeat disabled (passive service)
    heartbeat: false
    # Memory disabled (stateless for security isolation)
    memory_search: false
    # Web research service agent (peer, not helper)
    # Receives tasks via sessions_send from Main or Manager
    # Stateless, passive, write-only - security isolation for web content
    tools_allow:
      - web_search
      - web_fetch
      - read
      - write
    tools_deny:
      - exec
      - edit              # Write-only, no modifications
      - apply_patch       # Write-only, no modifications
      - memory_search     # Stateless - no PKM access
      - memory_get        # Stateless - no PKM access
      - sessions_spawn    # No nested spawning
      - sessions_send     # Passive - cannot initiate comms
      - browser
      - canvas
      - cron
      - gateway
    agents_sections:
      - web-base  # Uses templates/prompts/web/AGENTS.md

  <agent-id>-guru:
    workspace: /Users/<bot-username>/agents/<agent-id>-guru
    prompts: [agents, tools]
    # Model: opus for thorough technical reasoning
    model: opus
    # Heartbeat disabled (reactive specialist)
    heartbeat: false
    # Technical specialist agent (peer)
    # Receives deep-dive tasks via sessions_send from Main
    # Opus model for thorough reasoning
    # Has full file access, exec, memory - like Main
    # Can reach -web for research via sessions_send
    tools_allow:
      - read
      - write
      - edit
      - exec
      - group:memory
      - sessions_send     # Can reach -web for research
      - sessions_list
      - session_status
    tools_deny:
      - web_search        # Use -web agent via sessions_send
      - web_fetch         # Use -web agent via sessions_send
      - sessions_spawn    # No helper spawning
      - browser
      - canvas
      - cron
      - gateway
      - message           # Guru doesn't send media directly
    agents_sections:
      - guru-base         # Uses templates/prompts/guru/AGENTS.md
      - continuity        # Same continuation pattern as Main
    tools_sections:
      - guru-base         # Uses templates/prompts/guru/TOOLS.md

# Subagent (helper) configuration - DEPRECATED
# v3.2: All agents use sessions_send to -web agent for web research
# No agents spawn helpers for web tasks (tool inheritance ceiling prevents it)
# Keeping minimal config for any remaining subagent use cases
subagents:
  max_concurrent: 2
  archive_after_minutes: 60
  model: anthropic/claude-sonnet-4-5
  tools_allow:
    - read
    - write
  tools_deny:
    - exec
    - browser
    - canvas
    - cron
    - gateway
    - sessions_spawn
    - web_search          # Cannot have tools parent doesn't have
    - web_fetch           # Cannot have tools parent doesn't have

# Export profiles for non-agent destinations
exports:
  claude:
    description: "Prompts for Claude Projects / Claude Code"
    output_dir: exports/claude
    flatten_export: true
    include:
      scope: [meta, reference, transcripts]
      type: [prompt, doc, refdoc, claude_code_log]
    exclude:
      sensitivity: [sensitive, restricted]
    redaction: [names, health]

  tests:
    description: "Local testing profile"
    output_dir: exports/tests
    skip_auto_export: true
    include:
      type: [prompt]
      scope: [meta, reference, transcripts]

defaults:
  redaction: []
